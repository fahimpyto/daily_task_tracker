<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Habit Tracker Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* â”€â”€â”€ TOKENS â”€â”€â”€ */
:root {
  --bg: #0c0f14;
  --surface: #141820;
  --surface-raised: #1a1f2e;
  --surface-hover: #222842;
  --border: rgba(255,255,255,0.07);
  --border-focus: rgba(99,102,241,0.5);

  --primary: #6366f1;
  --primary-dim: rgba(99,102,241,0.12);
  --green: #22c55e;
  --green-dim: rgba(34,197,94,0.12);
  --green-glow: rgba(34,197,94,0.35);
  --red: #ef4444;
  --red-dim: rgba(239,68,68,0.12);

  --t1: #f0f2f5;
  --t2: #9ca3af;
  --t3: #5c6370;

  --radius: 14px;
  --radius-sm: 8px;

  font-family: 'DM Sans', sans-serif;
}

/* â”€â”€â”€ RESET â”€â”€â”€ */
*{ box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; }
html{ scroll-behavior:smooth; }
body{
  background: var(--bg);
  color: var(--t1);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€â”€ AMBIENT BG â”€â”€â”€ */
.ambient{
  position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 700px 500px at 15% 20%, rgba(99,102,241,0.09) 0%, transparent 70%),
    radial-gradient(ellipse 600px 600px at 85% 75%, rgba(34,197,94,0.07) 0%, transparent 70%);
}

/* â”€â”€â”€ HEADER â”€â”€â”€ */
header{
  position:sticky; top:0; z-index:100;
  background:rgba(12,15,20,0.82);
  backdrop-filter:blur(24px);
  -webkit-backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);
}
.header-inner{
  max-width:1200px; margin:0 auto;
  padding:0 24px;
  height:64px;
  display:flex; align-items:center; justify-content:space-between; gap:16px;
}
.logo{ display:flex; align-items:center; gap:10px; flex-shrink:0; }
.logo-mark{
  width:34px; height:34px; border-radius:10px;
  background:linear-gradient(135deg,#6366f1,#8b5cf6);
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 4px 14px rgba(99,102,241,0.35);
}
.logo-mark svg{ width:18px; height:18px; }
.logo-text{
  font-family:'Playfair Display',serif;
  font-size:1.15rem; font-weight:700;
  color:var(--t1); letter-spacing:-0.02em;
}
.logo-text span{ color:var(--green); }

/* nav pills */
.nav-pills{ display:flex; gap:6px; align-items:center; }
.pill{
  padding:6px 14px; border-radius:20px; border:1px solid var(--border);
  background:transparent; color:var(--t2);
  font-size:0.82rem; font-weight:500; cursor:pointer;
  transition:all .2s; font-family:inherit;
}
.pill:hover{ background:var(--surface-raised); color:var(--t1); }
.pill.active{ background:var(--primary-dim); border-color:var(--primary); color:var(--primary); }

/* month bar */
.month-bar{ display:flex; align-items:center; gap:8px; }
.month-bar select,
.month-bar input[type=number]{
  background:var(--surface-raised); border:1px solid var(--border);
  color:var(--t1); border-radius:var(--radius-sm);
  padding:7px 10px; font-size:0.85rem; font-family:inherit;
  outline:none; cursor:pointer;
  transition:border-color .2s;
}
.month-bar select:focus,
.month-bar input[type=number]:focus{ border-color:var(--border-focus); }
.month-bar input[type=number]{ width:72px; text-align:center; }
.go-btn{
  width:34px; height:34px; border-radius:var(--radius-sm);
  background:var(--primary); border:none; color:#fff;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size:1rem; transition:background .2s, transform .1s;
}
.go-btn:hover{ background:#4f46e5; }
.go-btn:active{ transform:scale(.93); }

/* â”€â”€â”€ LAYOUT â”€â”€â”€ */
.page{
  position:relative; z-index:1;
  max-width:1200px; margin:0 auto;
  padding:28px 24px;
  display:grid;
  grid-template-columns:280px 1fr;
  gap:24px;
  min-height:calc(100vh - 64px);
}

/* â”€â”€â”€ CARD â”€â”€â”€ */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
}
.card-head{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:16px;
}
.card-head h3{
  font-size:0.88rem; font-weight:600; color:var(--t2);
  text-transform:uppercase; letter-spacing:0.06em;
}
.card-head .badge{
  font-size:0.75rem; font-weight:600; padding:3px 10px;
  border-radius:12px; background:var(--primary-dim); color:var(--primary);
}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€ */
.sidebar{ display:flex; flex-direction:column; gap:16px; }

/* --- stat ring --- */
.stat-ring-wrap{
  display:flex; flex-direction:column; align-items:center;
  padding:24px 0 18px;
  background:linear-gradient(160deg, var(--surface-raised) 0%, var(--surface) 100%);
  border-radius:16px; margin-bottom:4px;
}
.ring-svg{ width:100px; height:100px; transform:rotate(-90deg); }
.ring-bg{ fill:none; stroke:var(--surface-raised); stroke-width:9; }
.ring-fg{ fill:none; stroke:var(--green); stroke-width:9; stroke-linecap:round; transition:stroke-dashoffset .6s cubic-bezier(.4,0,.2,1); }
.ring-center{
  position:absolute; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
}
.ring-wrap{ position:relative; width:100px; height:100px; }
.ring-value{ font-size:1.55rem; font-weight:700; color:var(--t1); line-height:1; }
.ring-label{ font-size:0.7rem; color:var(--t3); margin-top:3px; text-transform:uppercase; letter-spacing:0.05em; }
.stat-row{
  display:flex; gap:12px; width:100%; margin-top:18px; padding:0 4px;
}
.stat-box{
  flex:1; text-align:center;
  background:var(--surface); border-radius:10px; padding:10px 4px;
  border:1px solid var(--border);
}
.stat-box-val{ font-size:1.1rem; font-weight:700; color:var(--t1); }
.stat-box-lbl{ font-size:0.68rem; color:var(--t3); text-transform:uppercase; letter-spacing:0.04em; margin-top:2px; }

/* --- habit list sidebar --- */
.habit-sidebar-list{ display:flex; flex-direction:column; gap:6px; max-height:220px; overflow-y:auto; }
.habit-sidebar-list::-webkit-scrollbar{ width:4px; }
.habit-sidebar-list::-webkit-scrollbar-thumb{ background:var(--border); border-radius:2px; }
.hsb-item{
  display:flex; align-items:center; gap:10px;
  padding:9px 12px; border-radius:var(--radius-sm);
  background:var(--surface-raised); border:1px solid transparent;
  transition:all .15s;
}
.hsb-item:hover{ border-color:var(--border); }
.hsb-dot{ width:8px; height:8px; border-radius:50%; background:var(--primary); flex-shrink:0; }
.hsb-name{ font-size:0.88rem; color:var(--t1); flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.hsb-del{
  width:24px; height:24px; border-radius:6px; border:none;
  background:transparent; color:var(--t3); cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:1rem; transition:all .15s; opacity:0;
}
.hsb-item:hover .hsb-del{ opacity:1; }
.hsb-del:hover{ background:var(--red-dim); color:var(--red); }

/* --- achievements --- */
.ach-item{
  display:flex; align-items:flex-start; gap:10px;
  padding:10px 12px; border-radius:var(--radius-sm);
  background:var(--surface-raised); border:1px solid var(--green-dim);
  margin-bottom:6px; animation:popIn .25s ease;
}
.ach-icon{ font-size:1rem; flex-shrink:0; margin-top:1px; }
.ach-text{ font-size:0.85rem; color:var(--t1); line-height:1.4; flex:1; }
.ach-del{
  width:22px; height:22px; border-radius:6px; border:none;
  background:transparent; color:var(--t3); cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:.95rem; transition:all .15s; flex-shrink:0;
}
.ach-del:hover{ background:var(--red-dim); color:var(--red); }

/* --- input row --- */
.input-row{ display:flex; gap:8px; margin-top:10px; }
.input-row input[type=text]{
  flex:1; padding:9px 14px; border-radius:var(--radius-sm);
  border:1px solid var(--border); background:var(--surface-raised);
  color:var(--t1); font-size:0.87rem; font-family:inherit; outline:none;
  transition:border-color .2s;
}
.input-row input[type=text]:focus{ border-color:var(--border-focus); }
.input-row input[type=text]::placeholder{ color:var(--t3); }
.add-btn{
  width:38px; height:38px; border-radius:var(--radius-sm);
  background:var(--primary); border:none; color:#fff;
  font-size:1.3rem; cursor:pointer; display:flex; align-items:center; justify-content:center;
  transition:background .2s, transform .1s; line-height:1;
}
.add-btn:hover{ background:#4f46e5; }
.add-btn:active{ transform:scale(.92); }

/* notes */
.notes-ta{
  width:100%; min-height:110px; background:var(--surface-raised);
  border:1px solid var(--border); border-radius:var(--radius-sm);
  color:var(--t1); padding:12px 14px; font-size:0.87rem;
  font-family:inherit; resize:vertical; outline:none; line-height:1.55;
  transition:border-color .2s;
}
.notes-ta:focus{ border-color:var(--border-focus); }
.notes-ta::placeholder{ color:var(--t3); }

/* â”€â”€â”€ MAIN â€” TABLE â”€â”€â”€ */
.main-col{ display:flex; flex-direction:column; gap:16px; }

.table-scroll{
  overflow-x:auto;
  border-radius:12px;
  /* custom scrollbar */
}
.table-scroll::-webkit-scrollbar{ height:6px; }
.table-scroll::-webkit-scrollbar-track{ background:var(--surface-raised); border-radius:3px; }
.table-scroll::-webkit-scrollbar-thumb{ background:var(--border); border-radius:3px; }

table{ width:100%; border-collapse:collapse; min-width:520px; }
thead th{
  background:var(--surface-raised);
  color:var(--t3); font-size:0.72rem; font-weight:600;
  text-transform:uppercase; letter-spacing:0.06em;
  padding:11px 6px; text-align:center;
  border-bottom:2px solid var(--border);
  position:sticky; top:0;
}
thead th:first-child{ text-align:left; padding-left:18px; min-width:160px; }
thead th.today-th{ color:var(--green); }

tbody tr{ transition:background .15s; }
tbody tr:hover{ background:rgba(255,255,255,0.025); }
tbody tr:not(:last-child) td{ border-bottom:1px solid var(--border); }

/* name cell */
.name-cell{
  padding:11px 18px; font-size:0.92rem; font-weight:500;
  color:var(--t1); cursor:text; min-width:160px;
  outline:none; transition:background .15s;
  white-space:nowrap;
}
.name-cell:focus{ background:var(--primary-dim); border-radius:6px; }

/* checkbox cell */
.cb-cell{
  width:42px; padding:8px 2px; text-align:center;
}
.cb-wrap{
  width:34px; height:34px; margin:0 auto; position:relative; cursor:pointer;
}
.cb-wrap input{ position:absolute; inset:0; opacity:0; width:100%; height:100%; cursor:pointer; z-index:2; margin:0; }
.cb-face{
  width:100%; height:100%; border-radius:9px;
  border:2px solid rgba(255,255,255,0.13);
  background:var(--surface-raised);
  display:flex; align-items:center; justify-content:center;
  transition:all .22s cubic-bezier(.4,0,.2,1);
  position:relative; overflow:hidden;
}
.cb-wrap:hover .cb-face{ border-color:rgba(255,255,255,0.28); transform:scale(1.06); }
.cb-wrap input:checked + .cb-face{
  background:var(--green); border-color:var(--green);
  box-shadow:0 0 14px var(--green-glow);
}
.cb-face .tick{
  opacity:0; transform:scale(0) rotate(-10deg);
  transition:all .2s cubic-bezier(.4,0,.2,1);
  color:#fff; font-size:1.1rem; font-weight:700;
}
.cb-wrap input:checked + .cb-face .tick{ opacity:1; transform:scale(1) rotate(0deg); }

/* today column highlight */
.today-col{ background:rgba(34,197,94,0.04); }
.today-col .cb-face{ border-color:rgba(34,197,94,0.25); }

/* action cell */
.act-cell{ width:44px; padding:8px 4px; text-align:center; }
.row-del{
  width:30px; height:30px; border-radius:6px; border:none;
  background:transparent; color:var(--t3); cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:1.05rem; transition:all .15s; opacity:0;
}
tbody tr:hover .row-del{ opacity:1; }
.row-del:hover{ background:var(--red-dim); color:var(--red); }

/* empty */
.empty-row td{
  padding:60px 20px; text-align:center;
}
.empty-icon{ font-size:2.8rem; opacity:.4; margin-bottom:10px; }
.empty-title{ font-size:1rem; color:var(--t2); font-weight:600; margin-bottom:4px; }
.empty-sub{ font-size:0.82rem; color:var(--t3); }

/* â”€â”€â”€ CHART â”€â”€â”€ */
.chart-wrap{ padding:12px 0 4px; }
canvas{ display:block; width:100% !important; height:80px !important; }

/* â”€â”€â”€ TOAST â”€â”€â”€ */
#toast{
  position:fixed; bottom:28px; left:50%; transform:translate(-50%,140px);
  background:#1a1f2e; border:1px solid var(--green-dim);
  color:var(--t1); padding:11px 22px; border-radius:24px;
  font-size:0.85rem; font-weight:500;
  box-shadow:0 8px 28px rgba(0,0,0,0.4);
  transition:transform .35s cubic-bezier(.4,0,.2,1);
  z-index:999; display:flex; align-items:center; gap:8px;
  white-space:nowrap;
}
#toast .toast-icon{ color:var(--green); font-size:1rem; }
#toast.show{ transform:translate(-50%,0); }

/* â”€â”€â”€ CONFIRM OVERLAY â”€â”€â”€ */
.overlay{
  position:fixed; inset:0; background:rgba(0,0,0,.55);
  z-index:500; display:flex; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; transition:opacity .2s;
}
.overlay.open{ opacity:1; pointer-events:auto; }
.confirm-box{
  background:var(--surface); border:1px solid var(--border);
  border-radius:18px; padding:28px 26px; max-width:340px; width:90%;
  transform:scale(.92); transition:transform .2s cubic-bezier(.4,0,.2,1);
}
.overlay.open .confirm-box{ transform:scale(1); }
.confirm-icon{ font-size:2rem; margin-bottom:8px; }
.confirm-title{ font-size:1rem; font-weight:600; color:var(--t1); margin-bottom:6px; }
.confirm-msg{ font-size:0.83rem; color:var(--t2); line-height:1.5; margin-bottom:20px; }
.confirm-btns{ display:flex; gap:10px; justify-content:flex-end; }
.confirm-btns button{
  padding:8px 18px; border-radius:8px; border:none;
  font-size:0.84rem; font-weight:600; cursor:pointer; font-family:inherit;
  transition:all .15s;
}
.btn-cancel{ background:var(--surface-raised); color:var(--t2); }
.btn-cancel:hover{ background:var(--surface-hover); color:var(--t1); }
.btn-confirm-del{ background:var(--red); color:#fff; }
.btn-confirm-del:hover{ background:#dc2626; }

/* â”€â”€â”€ ANIMATIONS â”€â”€â”€ */
@keyframes popIn{ from{opacity:0;transform:translateY(-6px)} to{opacity:1;transform:translateY(0)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE â€” TABLET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:1024px){
  .page{ grid-template-columns:1fr; }
  .sidebar{ order:2; display:grid; grid-template-columns:1fr 1fr; }
  .main-col{ order:1; }
  .sidebar .card:first-child{ grid-column:1/-1; } /* overview full width */
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE â€” PHONE  (â‰¤ 640px)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:640px){
  /* header */
  .header-inner{ padding:0 16px; height:auto; padding-top:14px; padding-bottom:14px; flex-wrap:wrap; gap:10px; }
  .logo-text{ font-size:1rem; }
  .nav-pills{ width:100%; justify-content:center; order:3; }
  .month-bar{ order:2; width:100%; justify-content:center; }

  /* layout */
  .page{ padding:16px; gap:16px; }
  .sidebar{ order:2; grid-template-columns:1fr; }
  .main-col{ order:1; }

  /* table â†’ card stack on mobile */
  .table-scroll{ overflow:visible; }
  table{ min-width:unset; width:100%; border-collapse:separate; border-spacing:0 10px; }
  thead{ display:none; }

  tbody tr{
    background:var(--surface-raised);
    border:1px solid var(--border);
    border-radius:14px;
    box-shadow:0 2px 10px rgba(0,0,0,0.2);
  }
  tbody tr:hover{ background:var(--surface-raised); }
  tbody tr:not(:last-child) td{ border-bottom:none; }

  /* name row becomes a flex header bar */
  .name-row{
    display:flex; align-items:center; justify-content:space-between;
    padding:13px 15px 11px;
    border-bottom:1px solid var(--border);
    background:var(--surface);
    border-radius:14px 14px 0 0;
  }
  .name-cell{
    flex:1; padding:0 !important;
    font-size:0.95rem; min-width:0;
    background:transparent; border-radius:0;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .name-cell:focus{ background:rgba(99,102,241,0.08); padding:2px 6px !important; border-radius:6px; }

  /* checkbox grid */
  .cb-row{
    display:grid; grid-template-columns:repeat(7,1fr);
    gap:4px; padding:10px 12px 12px;
  }
  .cb-cell{
    width:100%; padding:3px 0; text-align:center;
    display:flex; flex-direction:column; align-items:center;
  }
  .cb-cell .day-num{
    display:block; font-size:0.62rem; color:var(--t3);
    margin-bottom:4px; font-weight:600;
  }
  .cb-wrap{ width:32px; height:32px; }
  .cb-face .tick{ font-size:0.9rem; }

  /* hide desktop action col */
  .act-cell{ display:none; }

  /* mobile delete button sits in name-row */
  .mobile-del{
    width:30px; height:30px; border-radius:8px; border:none;
    background:var(--red-dim); color:var(--red); cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    font-size:1.05rem; transition:all .15s; flex-shrink:0; margin-left:10px;
  }
  .mobile-del:hover{ background:rgba(239,68,68,0.3); }

  /* stat ring smaller */
  .ring-svg{ width:80px; height:80px; }
  .ring-wrap{ width:80px; height:80px; }
  .ring-value{ font-size:1.25rem; }

  /* card padding */
  .card{ padding:16px; }

  /* toast */
  #toast{ bottom:20px; }
}

@media(max-width:360px){
  .cb-cell{ width:20%; } /* 5 per row on very small screens */
}
</style>
</head>
<body>
<div class="ambient"></div>

<!-- HEADER -->
<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-mark">
        <svg viewBox="0 0 18 18" fill="none"><path d="M3 9.5L7 13.5L15 5" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div class="logo-text">Habit<span>Pro</span></div>
    </div>
    <div class="month-bar">
      <select id="monthSel"></select>
      <input type="number" id="yearSel" min="2020" max="2035">
      <button class="go-btn" onclick="initMonth()">â†’</button>
    </div>
    <div class="nav-pills">
      <button class="pill active" id="pill-log" onclick="switchTab('log')">Log</button>
      <button class="pill" id="pill-ach" onclick="switchTab('ach')">Achievements</button>
      <button class="pill" id="pill-notes" onclick="switchTab('notes')">Notes</button>
    </div>
  </div>
</header>

<!-- PAGE -->
<div class="page">

  <!-- SIDEBAR -->
  <aside class="sidebar">

    <!-- Overview -->
    <div class="card" id="card-overview">
      <div class="card-head"><h3>Overview</h3></div>
      <div class="stat-ring-wrap">
        <div class="ring-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100">
            <circle class="ring-bg" cx="50" cy="50" r="40"/>
            <circle class="ring-fg" id="ringFg" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="251.2"/>
          </svg>
          <div class="ring-center">
            <div class="ring-value" id="ringVal">0%</div>
            <div class="ring-label">Done</div>
          </div>
        </div>
        <div class="stat-row">
          <div class="stat-box"><div class="stat-box-val" id="statChecked">0</div><div class="stat-box-lbl">Checked</div></div>
          <div class="stat-box"><div class="stat-box-val" id="statStreak">0</div><div class="stat-box-lbl">Streak</div></div>
          <div class="stat-box"><div class="stat-box-val" id="statBest">0</div><div class="stat-box-lbl">Best Day</div></div>
        </div>
      </div>
      <div class="chart-wrap"><canvas id="chart"></canvas></div>
    </div>

    <!-- My Habits -->
    <div class="card" id="card-habits">
      <div class="card-head"><h3>My Habits</h3><span class="badge" id="habitBadge">0</span></div>
      <div class="habit-sidebar-list" id="habitSidebar"></div>
      <div class="input-row">
        <input type="text" id="habitInput" placeholder="e.g. Meditate 10 min">
        <button class="add-btn" onclick="addHabit()">+</button>
      </div>
    </div>

    <!-- Achievements (shown via tab on mobile) -->
    <div class="card" id="card-ach">
      <div class="card-head"><h3>Achievements</h3><span class="badge" id="achBadge" style="background:var(--green-dim);color:var(--green);">0</span></div>
      <div id="achList"></div>
      <div class="input-row">
        <input type="text" id="achInput" placeholder="e.g. 7-day streak">
        <button class="add-btn" onclick="addAch()" style="background:var(--green);">+</button>
      </div>
    </div>

    <!-- Notes -->
    <div class="card" id="card-notes">
      <div class="card-head"><h3>Notes</h3></div>
      <textarea class="notes-ta" id="notesTA" placeholder="Reflections, goalsâ€¦"></textarea>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main-col">
    <div class="card">
      <div class="card-head">
        <h3 id="mainTitle">Habit Log</h3>
      </div>
      <div class="table-scroll">
        <table id="habitTable"></table>
      </div>
    </div>
  </main>
</div>

<!-- TOAST -->
<div id="toast"><span class="toast-icon">âœ“</span><span id="toastMsg">Done</span></div>

<!-- CONFIRM -->
<div class="overlay" id="overlay">
  <div class="confirm-box">
    <div class="confirm-icon">ğŸ—‘ï¸</div>
    <div class="confirm-title">Delete Habit?</div>
    <div class="confirm-msg" id="confirmMsg">This will remove the habit and all its check data for this month.</div>
    <div class="confirm-btns">
      <button class="btn-cancel" onclick="closeConfirm()">Cancel</button>
      <button class="btn-confirm-del" id="confirmOk">Delete</button>
    </div>
  </div>
</div>

<script>
/* â”€â”€â”€ DATA â”€â”€â”€ */
const MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
let cur={m:new Date().getMonth(), y:new Date().getFullYear()};
let data={};   // key â†’ {habits[], checks{}, achievements[], notes}

/* â”€â”€â”€ BOOT â”€â”€â”€ */
(function(){
  const ms=document.getElementById('monthSel');
  MONTHS.forEach((n,i)=>{ const o=document.createElement('option'); o.value=i; o.textContent=n; ms.appendChild(o); });
  ms.value=cur.m;
  document.getElementById('yearSel').value=cur.y;

  // load persisted
  try{ const s=localStorage.getItem('htp3'); if(s) data=JSON.parse(s); }catch(e){}

  initMonth();
})();

/* â”€â”€â”€ HELPERS â”€â”€â”€ */
function key(){ return cur.y+'-'+cur.m; }
function daysIn(y,m){ return new Date(y,m+1,0).getDate(); }
function save(){ try{localStorage.setItem('htp3',JSON.stringify(data))}catch(e){} }
function ensureKey(){
  if(!data[key()]) data[key()]={habits:[],checks:{},achievements:[],notes:""};
}

/* â”€â”€â”€ INIT MONTH â”€â”€â”€ */
function initMonth(){
  cur.m=+document.getElementById('monthSel').value;
  cur.y=+document.getElementById('yearSel').value;
  document.getElementById('mainTitle').textContent=MONTHS[cur.m]+' '+cur.y;
  ensureKey();
  render();
}

/* â”€â”€â”€ FULL RENDER â”€â”€â”€ */
function render(){
  renderTable();
  renderSidebar();
  renderAch();
  renderNotes();
  calcStats();
}

/* â”€â”€â”€ TABLE â”€â”€â”€ */
function renderTable(){
  ensureKey();
  const d=data[key()], T=document.getElementById('habitTable');
  const days=daysIn(cur.y,cur.m);
  const today=new Date(), isThisMonth=(today.getFullYear()===cur.y && today.getMonth()===cur.m);
  const todayD=isThisMonth?today.getDate():-1;

  let html='';

  if(!d.habits.length){
    html=`<tr class="empty-row"><td colspan="100%">
      <div class="empty-icon">ğŸŒ±</div>
      <div class="empty-title">No habits yet</div>
      <div class="empty-sub">Add a habit in the sidebar to begin tracking</div>
    </td></tr>`;
    T.innerHTML=html; return;
  }

  // thead
  let ths='<th>Habit</th>';
  for(let i=1;i<=days;i++){
    const cls=i===todayD?' today-th':'';
    ths+=`<th class="${cls}">${i}${i===todayD?'<br><span style="font-size:.6rem;color:var(--green);">â—</span>':''}</th>`;
  }
  ths+='<th></th>';
  html+=`<thead><tr>${ths}</tr></thead>`;

  // tbody
  html+='<tbody>';
  d.habits.forEach((name,hi)=>{
    html+=`<tr>`;
    // name cell  â€” contains mobile-del button
    html+=`<td class="name-cell" contenteditable="true" data-hi="${hi}" onblur="updateName(${hi},this.textContent)" onkeydown="if(event.key==='Enter'){event.preventDefault();this.blur()}">${esc(name)}<button class="mobile-del" onclick="askDel(${hi})" style="display:none;">âœ•</button></td>`;
    // cb cells
    for(let d2=1;d2<=days;d2++){
      const ck=d2+'-'+hi;
      const checked=d.checks[ck]?'checked':'';
      const todayCls=d2===todayD?' today-col':'';
      html+=`<td class="cb-cell${todayCls}"><span class="day-num" style="display:none;">${d2}</span><label class="cb-wrap"><input type="checkbox" ${checked} onchange="toggleCb('${ck}',this.checked)"><div class="cb-face"><span class="tick">âœ“</span></div></label></td>`;
    }
    html+=`<td class="act-cell"><button class="row-del" onclick="askDel(${hi})">âœ•</button></td>`;
    html+=`</tr>`;
  });
  html+='</tbody>';
  T.innerHTML=html;

  // mobile layout adjustments
  applyMobile();
}

function applyMobile(){
  if(window.innerWidth>640) return;
  document.querySelectorAll('#habitTable tbody tr').forEach(tr=>{
    const nameCell=tr.querySelector('.name-cell');
    const cbCells=[...tr.querySelectorAll('.cb-cell')];
    const actCell=tr.querySelector('.act-cell');
    const hi=nameCell.dataset.hi;

    // â”€â”€ build name-row â”€â”€
    const nameRow=document.createElement('div');
    nameRow.className='name-row';

    // clone name into a clean editable span (avoids the old mobile-del child)
    const nameEl=document.createElement('div');
    nameEl.className='name-cell';
    nameEl.contentEditable='true';
    nameEl.textContent=nameCell.textContent.trim();
    nameEl.onblur=function(){ updateName(+hi,this.textContent); };
    nameEl.onkeydown=function(e){ if(e.key==='Enter'){e.preventDefault();this.blur();} };

    const delBtn=document.createElement('button');
    delBtn.className='mobile-del';
    delBtn.innerHTML='âœ•';
    delBtn.onclick=function(){ askDel(+hi); };

    nameRow.appendChild(nameEl);
    nameRow.appendChild(delBtn);

    // â”€â”€ build cb-row grid â”€â”€
    const cbRow=document.createElement('div');
    cbRow.className='cb-row';
    cbCells.forEach(c=>{
      const dn=c.querySelector('.day-num');
      if(dn) dn.style.display='block';
      cbRow.appendChild(c);
    });

    // â”€â”€ replace TR contents â”€â”€
    tr.innerHTML='';
    tr.appendChild(nameRow);
    tr.appendChild(cbRow);
  });
}

/* â”€â”€â”€ SIDEBAR habits â”€â”€â”€ */
function renderSidebar(){
  ensureKey();
  const d=data[key()];
  document.getElementById('habitBadge').textContent=d.habits.length;
  const el=document.getElementById('habitSidebar');
  el.innerHTML='';
  d.habits.forEach((n,i)=>{
    el.innerHTML+=`<div class="hsb-item"><div class="hsb-dot"></div><div class="hsb-name">${esc(n)}</div><button class="hsb-del" onclick="askDel(${i})">âœ•</button></div>`;
  });
}

/* â”€â”€â”€ ACHIEVEMENTS â”€â”€â”€ */
function renderAch(){
  ensureKey();
  const d=data[key()];
  document.getElementById('achBadge').textContent=d.achievements.length;
  const el=document.getElementById('achList');
  el.innerHTML='';
  d.achievements.forEach((a,i)=>{
    el.innerHTML+=`<div class="ach-item"><span class="ach-icon">ğŸ†</span><span class="ach-text">${esc(a)}</span><button class="ach-del" onclick="delAch(${i})">âœ•</button></div>`;
  });
}

/* â”€â”€â”€ NOTES â”€â”€â”€ */
function renderNotes(){
  ensureKey();
  document.getElementById('notesTA').value=data[key()].notes||'';
}

/* â”€â”€â”€ ACTIONS â”€â”€â”€ */
function addHabit(){
  const inp=document.getElementById('habitInput');
  const v=inp.value.trim();
  if(!v) return;
  ensureKey();
  data[key()].habits.push(v);
  inp.value='';
  save(); render(); toast('Habit added');
}

let _delIdx=-1;
function askDel(i){
  _delIdx=i;
  document.getElementById('confirmMsg').textContent=`Remove "${esc(data[key()].habits[i])}" and all its check data?`;
  document.getElementById('overlay').classList.add('open');
  document.getElementById('confirmOk').onclick=confirmDel;
}
function confirmDel(){
  if(_delIdx<0) return;
  ensureKey();
  const d=data[key()];
  d.habits.splice(_delIdx,1);
  // re-index checks
  const nc={};
  Object.keys(d.checks).forEach(k=>{
    const [day,hi]=k.split('-').map(Number);
    if(hi<_delIdx) nc[k]=d.checks[k];
    else if(hi>_delIdx) nc[day+'-'+(hi-1)]=d.checks[k];
  });
  d.checks=nc;
  _delIdx=-1;
  closeConfirm();
  save(); render(); toast('Habit deleted');
}
function closeConfirm(){ document.getElementById('overlay').classList.remove('open'); _delIdx=-1; }

function toggleCb(k,v){
  ensureKey();
  if(v) data[key()].checks[k]=true;
  else delete data[key()].checks[k];
  save(); calcStats();
}

function updateName(i,txt){
  ensureKey();
  const t=txt.replace(/<[^>]*>/g,'').trim(); // strip tags from contentEditable
  if(t) { data[key()].habits[i]=t; save(); renderSidebar(); toast('Updated'); }
  else renderTable();
}

function addAch(){
  const inp=document.getElementById('achInput');
  const v=inp.value.trim();
  if(!v) return;
  ensureKey();
  data[key()].achievements.push(v);
  inp.value='';
  save(); renderAch(); toast('Achievement added');
}
function delAch(i){
  ensureKey();
  data[key()].achievements.splice(i,1);
  save(); renderAch(); toast('Removed');
}

document.getElementById('notesTA').addEventListener('input',function(){
  ensureKey();
  data[key()].notes=this.value;
  save();
});

/* â”€â”€â”€ STATS & CHART â”€â”€â”€ */
function calcStats(){
  ensureKey();
  const d=data[key()];
  const days=daysIn(cur.y,cur.m);
  const hc=d.habits.length;
  let totalChecked=0, bestDay=0, streak=0, curStreak=0;
  const dailyPcts=[];
  const today=new Date().getDate();

  for(let day=1;day<=days;day++){
    let cnt=0;
    for(let h=0;h<hc;h++) if(d.checks[day+'-'+h]) cnt++;
    totalChecked+=cnt;
    if(cnt>bestDay) bestDay=cnt;
    dailyPcts.push(hc?Math.round(cnt/hc*100):0);
    // streak: consecutive days with all done (up to today)
    if(cnt===hc && hc>0) curStreak++; else curStreak=0;
    if(curStreak>streak) streak=curStreak;
  }

  const total=days*hc;
  const pct=total?Math.round(totalChecked/total*100):0;

  // ring
  document.getElementById('ringVal').textContent=pct+'%';
  const circ=2*Math.PI*40; // r=40
  document.getElementById('ringFg').style.strokeDashoffset=circ*(1-pct/100);

  // stats
  document.getElementById('statChecked').textContent=totalChecked;
  document.getElementById('statStreak').textContent=streak;
  document.getElementById('statBest').textContent=bestDay;

  // chart
  drawChart(dailyPcts);
}

function drawChart(arr){
  const c=document.getElementById('chart');
  const ctx=c.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  const rect=c.getBoundingClientRect();
  c.width=rect.width*dpr;
  c.height=rect.height*dpr;
  ctx.scale(dpr,dpr);
  const W=rect.width, H=rect.height;
  const pad={t:8,r:8,b:18,l:8};
  const gW=W-pad.l-pad.r, gH=H-pad.t-pad.b;

  ctx.clearRect(0,0,W,H);

  if(!arr.length) return;

  const xStep=gW/Math.max(arr.length-1,1);

  // grid lines
  ctx.strokeStyle='rgba(255,255,255,0.04)';
  ctx.lineWidth=1;
  [0,50,100].forEach(v=>{
    const y=pad.t+gH*(1-v/100);
    ctx.beginPath(); ctx.moveTo(pad.l,y); ctx.lineTo(W-pad.r,y); ctx.stroke();
  });

  // area
  ctx.beginPath();
  arr.forEach((v,i)=>{
    const x=pad.l+i*xStep;
    const y=pad.t+gH*(1-v/100);
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.lineTo(pad.l+(arr.length-1)*xStep, pad.t+gH);
  ctx.lineTo(pad.l, pad.t+gH);
  ctx.closePath();
  const grad=ctx.createLinearGradient(0,pad.t,0,pad.t+gH);
  grad.addColorStop(0,'rgba(34,197,94,0.25)');
  grad.addColorStop(1,'rgba(34,197,94,0.02)');
  ctx.fillStyle=grad;
  ctx.fill();

  // line
  ctx.beginPath();
  arr.forEach((v,i)=>{
    const x=pad.l+i*xStep;
    const y=pad.t+gH*(1-v/100);
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.strokeStyle='#22c55e';
  ctx.lineWidth=2.2;
  ctx.lineCap='round';
  ctx.lineJoin='round';
  ctx.stroke();

  // dots
  arr.forEach((v,i)=>{
    const x=pad.l+i*xStep;
    const y=pad.t+gH*(1-v/100);
    if(v>0){
      ctx.beginPath(); ctx.arc(x,y,2.8,0,Math.PI*2);
      ctx.fillStyle='#22c55e'; ctx.fill();
    }
  });

  // x-labels (first, mid, last)
  ctx.fillStyle='rgba(255,255,255,0.3)';
  ctx.font='9px DM Sans, sans-serif';
  ctx.textAlign='center';
  const labels=[[0,'1'],[Math.floor(arr.length/2),String(Math.floor(arr.length/2)+1)],[arr.length-1,String(arr.length)]];
  labels.forEach(([i,lbl])=>{
    ctx.fillText(lbl, pad.l+i*xStep, H-3);
  });
}

/* â”€â”€â”€ TOAST â”€â”€â”€ */
function toast(msg){
  document.getElementById('toastMsg').textContent=msg;
  const t=document.getElementById('toast');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2000);
}

/* â”€â”€â”€ TAB SWITCH (mobile nav) â”€â”€â”€ */
function switchTab(tab){
  // pills
  ['log','ach','notes'].forEach(t=>{
    document.getElementById('pill-'+t).classList.toggle('active',t===tab);
  });
  // on desktop all visible; on mobile we show/hide sidebar cards
  if(window.innerWidth>640) return; // desktop: all visible always

  // mobile: show only selected card(s)
  document.getElementById('card-overview').style.display='flex'; // always show overview
  document.getElementById('card-habits').style.display= (tab==='log')?'block':'none';
  document.getElementById('card-ach').style.display= (tab==='ach')?'block':'none';
  document.getElementById('card-notes').style.display= (tab==='notes')?'block':'none';
}

/* â”€â”€â”€ RESIZE â”€â”€â”€ */
let _rt;
window.addEventListener('resize',()=>{
  clearTimeout(_rt);
  _rt=setTimeout(()=>{
    calcStats();
    // reset mobile layout
    renderTable();
    // if desktop, show all cards
    if(window.innerWidth>640){
      ['card-overview','card-habits','card-ach','card-notes'].forEach(id=>document.getElementById(id).style.display='');
    }
  },120);
});

/* â”€â”€â”€ ENTER KEY â”€â”€â”€ */
document.getElementById('habitInput').addEventListener('keydown',e=>{ if(e.key==='Enter') addHabit(); });
document.getElementById('achInput').addEventListener('keydown',e=>{ if(e.key==='Enter') addAch(); });

/* â”€â”€â”€ OVERLAY close on bg click â”€â”€â”€ */
document.getElementById('overlay').addEventListener('click',function(e){ if(e.target===this) closeConfirm(); });

/* â”€â”€â”€ UTIL â”€â”€â”€ */
function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
</script>
</body>
</html>
